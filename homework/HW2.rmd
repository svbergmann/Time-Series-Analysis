---
title: "Time Series"
subtitle: "Homework 2"
author: Helen Kafka, Sven Bergmann
date: 02/28/24
output: pdf_document
---

```{r, echo = F}
library(knitr)
opts_chunk$set(tidy.opts = list(width.cutoff = 60),
               tidy = TRUE)
```

# Problem 2

## a)

```{r, warning = F, message = F}
library(TSA)
library(tseries)
```

```{r}
data(winnebago)
plot(winnebago, xlab = expression("Time"), ylab = expression("Sales"), main = expression("Time Series Plot of Winnebago"))
```

Interpretation:

- The time series shows an overall upwards trend between the years 1967 and 1972.
- Between the years 1970 and 1972 the increase is at its highest.

## b)


```{r}
lm_model_a <- lm(winnebago ~ time(winnebago))
summary(lm_model_a)
```

- We expect the wages to increase by $200.74 per year
- $69.15\%$ of the variance can be explained by the predictor variables
- the linear trend is significant because the p-value $2.2 \cdot 10^{-16}$ is smaller than $10^{-12}$

```{r}
plot(winnebago, xlab = expression("Time"), ylab = expression("Sales"), main = expression("Time Series Plot of Winnebago with a least squares regression fit"))
abline(lm_model_a, col = 'red')
```

```{r}
lm_model_a_std_res <- as.ts(rstandard(lm_model_a))
plot(lm_model_a_std_res, xlab = expression("Time"), ylab = expression("Residuals"), main = "Plot of Residuals versus Time")
abline(h = 0, col = 'red')
```

Interpretation:

- The residuals plot shows somewhat random movement around zero.
- More uneven spread between ca. 35 to 65 in comparison to 0 to 35.
- There may be a "seasonal" cyclical trend.


## c)

```{r}
ln_winnebago <- log(winnebago)
plot(ln_winnebago, xlab = expression("Time"), ylab = expression("ln Sales"), main = expression("Time Series Plot of Winnebago"))
```

Interpretation:

- The time series plot of the transformed values shows a linear upward trend (which corresponds with the untransformed data)
- There is one downward spike around the year 1970
- The "seasonal" trend seems more pronounced


## d)

```{r}
lm_model_d <- lm(ln_winnebago ~ time(ln_winnebago))
summary(lm_model_d)
```

```{r}
plot(ln_winnebago, xlab = expression("Time"), ylab = expression("ln Sales"), main = expression("Time Series Plot of Winnebago with a least squares regression fit"))
abline(lm_model_d, col = 'red')
```

```{r}
lm_model_d_std_res <- as.ts(rstandard(lm_model_d))
plot(lm_model_d_std_res, xlab = expression("Time"), ylab = expression("Residuals"), main = "ln Plot of Residuals versus Time")
abline(h = 0, col = 'red')
```

Interpretation:

- the ln-transformed residuals plot shows random movement around 0
- There seems to be an overall cyclical trend

## e)

```{r}
months <- season(winnebago)
lm_model_e <- lm(ln_winnebago ~ months + time(winnebago))
summary(lm_model_e)
```

- $89.46\%$ of the variance can be explained by the predictor variables
- the linear trend is significant because the p-value $2.2 \cdot 10^{-16}$ is smaller than $10^{-12}$

## f)

```{r}
lm_model_e_std_res <- as.ts(rstandard(lm_model_e))
plot(lm_model_e_std_res, x = as.vector(time(winnebago)), xlab = "Time", ylab = "Standardized Residuals", main = "Standardized Residuals", type = "l")
points(y = rstudent(lm_model_e), x = as.vector(time(winnebago)), pch = as.vector(season(winnebago)))
```

- looking at the residuals, we can revert our assumption of a seasonal trend
- we do not see an obvious pattern of the months at the highs and lows

## g)

```{r}
lm_model_e_res <- residuals(lm_model_e)
plot(lm_model_e_res, x = as.vector(time(winnebago)), xlab = "Time", ylab = "Residuals", main = "Residuals", type = "l")
```

## h)

```{r fig.height = 5}
acf(lm_model_a_std_res, main = "Autocorrelation Plot of Residuals for linear model a")
```

- significant autocorrelation at lags 1, 2, 3
- somewhat periodic behaviour starting at lag 7
- small magnitude with ca. .3

```{r fig.height = 5}
acf(lm_model_d_std_res, main = "Autocorrelation Plot of Residuals for linear model d")
```

- significant autocorrelation at lags 1, 2, 11, 12, 16, 17, 18
- periodic behaviour

```{r fig.height = 5}
acf(lm_model_e_std_res, main = "Autocorrelation Plot of Residuals for linear model e")
```

- significant autocorrelation at lags 1, 2, 13
- cyclic trend
- magnitude with about .6

## i)

```{r}
par(mfrow = c(1, 2))
qqnorm(lm_model_a_std_res, main = "Normal Probability Plot vs \n Residuals Fit for lm a")
abline(a = 0, b = 1, col = 'red')
hist(lm_model_a_std_res, xlab = "Residual", main = "Histogram of Residuals \n for lm a")
```

- The quantiles of the linear model a are a little bit off everywhere but somewhat equally spreaded around the line and we have one outlier at about 4.
- Data looks somewhat normally distributed based on the histogram.

```{r}
par(mfrow = c(1, 2))
qqnorm(lm_model_d_std_res, main = "Normal Probability Plot vs \n Residuals Fit for lm d")
abline(a = 0, b = 1, col = 'red')
hist(lm_model_d_std_res, xlab = "Residual", main = "Histogram of Residuals \n for lm d")
```

- Again, we have outliers at -3 and 2 but not as bad as in linear model a.
- Looking at the histogram, we have normal distributed data if we do not take the values at -2 into account.

```{r}
par(mfrow = c(1, 2))
qqnorm(lm_model_e_std_res, main = "Normal Probability Plot vs \n Residuals Fit for lm e")
abline(a = 0, b = 1, col = 'red')
hist(lm_model_e_std_res, xlab = "Residual", main = "Histogram of Residuals \n for lm e")
```

- The quantiles look great, nearly all of them are very close to the line.
- The histogram shows a nearly normal distribution but the values from -1 to 0 and 0 to 1 are not that symmetric as they should be.

### Problem 3

## c)

```{r}
phi <- seq(from = -1, to = 1, by = 0.01)
y <- (1 + phi) / (1 - phi)
plot(phi, y, pch = 8)
```

The closer $\phi$ is to -1, the closer the variance is to 0, thus the precision increases.
The closer $\phi$ is to 1, the more the variance increases, and thus the precision decreases.